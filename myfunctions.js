/* myFunctions.js */

// =========================================================
// وظيفة الإخفاء والإظهار (JQuery)
// يجب أن تكون هذه الدالة أولاً في الملف لتعمل
// =========================================================
$(document).ready(function() {
    // عند النقر على أي زر يحمل الكلاس 'toggle-details' في صفحة apps.html
    $('.toggle-details').on('click', function() {
        // نستخدم التابع slideToggle لإخفاء/إظهار الصف التفصيلي التالي في الجدول
        // .closest('tr'): يجد أقرب صف (TR) للزر الذي تم النقر عليه
        // .next('.detail-row'): يختار الصف الذي يليه مباشرة ويحمل الكلاس 'detail-row'
        $(this).closest('tr').next('.detail-row').slideToggle(300);
    });
});


// =========================================================
// دالة التحقق من المدخلات ونقل البيانات (Validation & Submit)
// هذه الدالة تعمل فقط عند الضغط على زر الإرسال في add_app.html
// =========================================================
function validateAndSubmit(event) {
    // منع الإرسال التلقائي لنموذج HTML
    event.preventDefault(); 
    
    let isValid = true;

    // إخفاء جميع رسائل الأخطاء مسبقاً باستخدام JQuery
    $('.error-message').hide(); 

    // ------------------------------------------------
    // 1. التحقق: اسم التطبيق (أحرف إنجليزية فقط بدون فراغات وبدون أرقام)
    // العلامة: 10
    // ------------------------------------------------
    const appName = $('#appName').val();
    // التعبير النمطي: يجب أن يحتوي على أحرف إنجليزية كبيرة أو صغيرة فقط (^ بداية و $ نهاية للتأكد من عدم وجود فراغات)
    const nameRegex = /^[a-zA-Z]+$/; 
    if (!nameRegex.test(appName)) {
        $('#appNameError').show();
        isValid = false;
    }

    // ------------------------------------------------
    // 2. التحقق: الشركة المصنعة (أحرف هجائية فقط باللغة الإنكليزية مع أرقام)
    // العلامة: 10
    // ------------------------------------------------
    const companyName = $('#companyName').val();
    // التعبير النمطي: يسمح بالأحرف الإنجليزية والأرقام فقط
    const companyRegex = /^[a-zA-Z0-9]+$/; 
    if (!companyRegex.test(companyName)) {
        $('#companyNameError').show();
        isValid = false;
    }

    // ------------------------------------------------
    // 3. التحقق: الموقع الإلكتروني (URL)
    // العلامة: 10
    // ------------------------------------------------
    const appURL = $('#appURL').val();
    if (appURL.trim() === '') {
        // التحقق من أن الحقل ليس فارغاً (نوع الحقل "url" في HTML يقوم ببقية التحقق)
        $('#appURLError').text('الموقع الإلكتروني مطلوب ولا يمكن أن يكون فارغاً.').show();
        isValid = false;
    }
    
    // ------------------------------------------------
    // 4. التحقق: مجال الاستخدام (قائمة محددة مسبقا)
    // العلامة: 10
    // ------------------------------------------------
    const category = $('#category').val();
    if (!category) {
        // التحقق من أن المستخدم اختار قيمة
        $('#categoryError').text('الرجاء اختيار مجال الاستخدام.').show();
        isValid = false;
    }

    
    // ------------------------------------------------
    // 5. نقل البيانات والانتقال (إذا كان التحقق ناجحاً)
    // العلامة: 10
    // ------------------------------------------------
    if (isValid) {
        // جمع بيانات النموذج
        const newApp = {
            name: appName,
            company: companyName,
            url: appURL,
            isFree: $('input[name="isFree"]:checked').val(), // قيمة الزر الراديوي
            category: category, 
            description: $('#shortDescription').val()
        };
        
        // نقل البيانات عبر localStorage لتظهر في صفحة apps.html
        localStorage.setItem('newAppAdded', JSON.stringify(newApp));
        
        // الانتقال إلى صفحة عرض التطبيقات (apps.html)
        window.location.href = 'Apps.html';
    }
    
    return isValid;
}
